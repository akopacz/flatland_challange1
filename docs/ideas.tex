\documentclass[aspectratio=169,12pt]{beamer}
%

% Choose how your presentation looks.
%
% For more themes, color themes and font themes, see:
% http://deic.uab.es/~iblanes/beamer_gallery/index_by_theme.html
%
\mode<presentation>
{
  \usetheme{Singapore}      % or try Darmstadt, Madrid, Warsaw, ...
  \usecolortheme{crane} % or try albatross, beaver, crane, seahorse ...
  \usefonttheme{professionalfonts}  % or try serif, structurebold, ...
  \setbeamertemplate{blocks}[rounded]%[shadow=true]
  \useinnertheme[shadow=true]{rounded}
%  \setbeamertemplate{navigation symbols}{}
%  \setbeamertemplate{caption}[numbered]
%  \setbeamertemplate{itemize item}{\color{black}$\bullet$}
} 

\usepackage[english]{babel}
\usepackage[utf8x]{inputenc}
\usepackage{amssymb,amsmath,relsize}
\usepackage{algpseudocode}
%\usepackage[ruled,vlined,linesnumbered,noresetcount]{algorithm2e}
\usepackage{tikz}
\usetikzlibrary{shapes,positioning,math,calc}

% TIKZ TIKZ commands
\tikzset{onslide/.code args={<#1>#2}{%
  \only<#1>{\pgfkeysalso{#2}} 
}} %% ! nice
% works as follows:  \node [onslide={<2,4>{green}}] (am) [right=of fe.center] {Acoustic Model};


%% left-out parts
%%\usepackage[export]{adjustbox}
%%\usepackage{media9}

%%\AtBeginSection[]
%%{
%%  \begin{frame}<beamer>
%%    \frametitle{Outline}
%%    \tableofcontents[currentsection,currentsubsection]
%%  \end{frame}
%%}

%%\newcommand\norm[1]{\left\lVert#1\right\rVert}
%%\SetKw{Break}{break}

\title[Flatland]{
	\large Ideas for Flatland\\
	~\\
	\small Suggestion  for representation
}

\author{Lehel CSATÓ$^1$ \and Hunor JAKAB$^{2,3}$ \and Levent KENT$^3$ \and Gyula SZABÓ$^2$}
\institute[UBB]{%\relsize{-1}
  $^1$Faculty of Mathematics and Informatics, 
  Babe\c{s}--Bolyai University of Cluj-Napoca  \\
  $^2$Accenture Romania \\
  $^3$Accenture Switzerland \\
}

\begin{document}

\frame{\maketitle}

%\begin{frame}
%  \titlepage
%\end{frame}

\begin{frame}[t]{Agent actions}


\begin{itemize}
\item If alone, then the $A^*$ algorithm is optimal.
\vfill
\vfill
\item If multiple agents on track, then:
\vfill
  \begin{enumerate}
  \item One must label the \alert{map}: 
    \begin{itemize}
    \item Identify regions locked by agents;
    \item (if needed) identify \emph{likelihood} of cells being occupied at a future time.
    \end{itemize}
\vfill
  \item Calculate -- using graph search in a labelled graph -- the shortest times to destination.
\vfill
  \item Prioritize the agents -- suggested prioritization criterion is the \alert{expected shortest arrival} to the destination.
  \end{enumerate}

\end{itemize}

\vfill

\hfill \beamergotobutton{\relsize{2}Details of each step}
\vspace*{-0cm}
\end{frame}

\begin{frame}
  \frametitle{Labelling the map \quad I}

% PGF and latex cannot work with multiple images within a GIF.
% solution is to:
%   1. serialise using the command: 
%         convert -coalesce flatland1.gif fl1.png
%   2. choose the resulting PNG (or more) to include in latex
%
\begin{tikzpicture}[remember picture,overlay,onslide={<2->{semitransparent}}]%
  \node (fl_im) [below=1.5cm of current page.north]%
  { \pgfimage[width=\linewidth]{images/fl1-5_annotated}
  };%
  \coordinate (point_at_1) at ( $(fl_im.center) + (-1.9cm,1.1cm)$ );
  \coordinate (point_at_2) at ( $(fl_im.center) + (-1.9cm,-2.5cm)$);
\end{tikzpicture}

\only<2->{
\begin{tikzpicture}[remember picture,overlay,>=latex]%
  \node (concl)
    [ scale=.625,text opacity=1,rounded corners,inner sep=8pt,%
      xshift=-3cm,
      below right=2.5cm of current page.north,
      fill=title.bg!60!white,
      fill opacity=.4]%
  { \begin{minipage}{.85\linewidth}
    \textbf{Facts:}\\
     Given the current position for each agent, there are locations that \alert{will cause deadlock} if occupied by an other agent.
    \vspace*{.3cm}
    \begin{alertblock}{Resolution}
      Labelling the nodes as \alert{busy for -- at least -- time $t$}.\\
      \vspace*{.2cm}
      This labelling:
        \begin{itemize}
        \item is \alert{independent} of agent actions,
        \item can be computed in fixed time,
        \item can be included in the $A^*$ algorithm. \hfill \visible<3->{{\relsize{1}\bfseries Can it?}}
        \end{itemize}
    \end{alertblock}
    \vspace*{1cm}
    \visible<3->{%
      \begin{block}{Note:}
      Instead of $A^*$ we could use other graph search methods.
      \end{block}
    }
    \end{minipage}
  };%
  \begin{scope}[blue,line width=2pt,bend right]
    \draw (concl.west)[->] to (point_at_1.center);
    \draw (concl.west)[->] to (point_at_2.center);
  \end{scope}
\end{tikzpicture}
}
\end{frame}

\begin{frame}
  \frametitle{Labelling the map \quad II}

% PGF and latex cannot work with multiple images within a GIF.
% solution is to:
%   1. serialise using the command: 
%         convert -coalesce flatland1.gif fl1.png
%   2. choose the resulting PNG (or more) to include in latex
%
% if one wishes to change a TIKZ attribute: onslide={<2->{semitransparent}}
\begin{tikzpicture}[remember picture,overlay,semitransparent]%
  \node (fl_im) [below=1.5cm of current page.north]%
  { \pgfimage[width=\linewidth]{images/fl1-1}
  };%
  \coordinate (point_at_1) at ( $(fl_im.center) + (-1.9cm,1.1cm)$ );
  \node (point_at_2) at ( $(fl_im.center) + (-1.9cm,-2.5cm)$ ) {.};
\end{tikzpicture}

\begin{tikzpicture}[remember picture,overlay,>=latex]%
  \node (concl)
    [ scale=.625,text opacity=1,rounded corners,inner sep =8pt,%
      xshift=-3cm,
      below right=2.5cm of current page.north,
      fill=title.bg!60!white,
      fill opacity=.4]%
  { \begin{minipage}{.85\linewidth}
    \textbf{Several agents using the same network:}\\
     When the agent is \emph{expected to reach} that position, it could be at a conflicting state with other agents.
    \vspace*{.5cm}
    \begin{alertblock}{Resolution}
      The graph search algorithm must run on the modified graph that includes times when a node
      \alert{\bfseries is not available}.\\
      \vspace*{.25cm}
      This availability depends on \alert{\bfseries node ordering}.
    \end{alertblock}
    \vspace*{.3cm}
    \visible<2->{
    \begin{alertblock}{A suggestion therefore is to:}
    \begin{enumerate}
    \item Let the system \alert{know} the order that a given agent was given;
    \vspace*{.3cm}
    \item \alert{\bfseries Simplification:} few \emph{priority classes} only:
      \begin{description}
      \item[First] --  first (a single agent);
      \item[Runners up] -- the next $25\%$ of agents;
      \item[Last ones] -- the rest -- $\approx 75\%$ -- of it.
      \end{description}
    \end{enumerate}
    \end{alertblock}
    }
    \end{minipage}
  };%
  \begin{scope}[blue,line width=2pt]
    \draw (concl.west)[->] -- (point_at_1.center);
    \draw (concl.west)[->] -- (point_at_2.center);
  \end{scope}
\end{tikzpicture}

\end{frame}

\begin{frame}{Shortest path calculation}

\begin{enumerate}
\item If alone, then the $A^*$ algorithm is optimal;
\vfill
\item If multiple agents are present, a solution is to:
  \begin{itemize}
  \item estimate the arrival times -- disregarding \alert{other agent positions}.\\
  \hfill These estimates take into account labelling (blocked positions);\\
  \hfill Sugg: if route blocked -- e.g. within $2$ steps -- then $t=\infty$.\\
  \hfill Will serve for agent ordering.
  \end{itemize}
\vfill
\item If an agent cannot move -- i.e. it is broken -- then $t=\infty$.
\end{enumerate}

\vfill
\vfill

\begin{block}{No obstruction rule}
  None of the agents can step onto a position that is labelled as conflicting.
\end{block}

\end{frame}

\begin{frame}[fragile]{Algorithm}

The suggested algorithm is therefore:

\begin{algorithmic}[1]
\While{$\mathrm{AgentList} \not= \emptyset$}
\State Label the map using the actual state
\State Compute shortest path and make the order
\State Perform the moves using the order of agents
\State* \qquad\qquad {\relsize{-1} Avoid stepping on forbidden states}
\EndWhile
\end{algorithmic}

\end{frame}



\end{document}
